function addLandformsToMap() {
            // Add source
            map.addSource('landforms', {
                'type': 'geojson',
                'data': landformsData
            });

            // Add highlight source (initially empty)
            map.addSource('highlight', {
                'type': 'geojson',
                'data': {
                    'type': 'FeatureCollection',
                    'features': []
                }
            });

            // Add highlight layers for different geometry types
            map.addLayer({
                'id': 'highlight-line',
                'type': 'line',
                'source': 'highlight',
                'filter': ['==', '$type', 'LineString'],
                'paint': {
                    'line-color': '#ff6b6b',
                    'line-width': 4,
                    'line-opacity': 0.8
                }
            });

            map.addLayer({
                'id': 'highlight-polygon',
                'type': 'fill',
                'source': 'highlight',
                'filter': ['==', '$type', 'Polygon'],
                'paint': {
                    'fill-color': '#ff6b6b',
                    'fill-opacity': 0.3,
                    'fill-outline-color': '#ff6b6b'
                }
            });

            map.addLayer({
                'id': 'highlight-polygon-outline',
                'type': 'line',
                'source': 'highlight',
                'filter': ['==', '$type', 'Polygon'],
                'paint': {
                    'line-color': '#ff6b6b',
                    'line-width': 3,
                    'line-opacity': 0.8
                }
            });

            map.addLayer({
                'id': 'highlight-point',
                'type': 'circle',
                'source': 'highlight',
                'filter': ['==', '$type', 'Point'],
                'paint': {
                    'circle-color': '#ff6b6b',
                    'circle-radius': 12,
                    'circle-opacity': 0.6,
                    'circle-stroke-color': '#ffffff',
                    'circle-stroke-width': 3
                }
            });

            // Add markers layer
            map.addLayer({
                'id': 'landforms-layer',
                'type': 'circle',
                'source': 'landforms',
                'paint': {
                    'circle-radius': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        5, 8,
                        10, 15
                    ],
                    'circle-color': [
                        'match',
                        ['get', 'type'],
                        'volcanic', '#e74c3c',
                        'mountain', '#27ae60',
                        'water', '#3498db',
                        'coastal', '#f39c12',
                        'special', '#9b59b6',
                        '#34495e'
                    ],
                    'circle-stroke-width': 2,
                    'circle-stroke-color': '#ffffff',
                    'circle-opacity': 0.8
                }
            });

            // Add labels layer
            map.addLayer({
                'id': 'landforms-labels',
                'type': 'symbol',
                'source': 'landforms',
                'layout': {
                    'text-field': ['get', ['literal', currentLanguage], ['get', 'name']],
                    'text-font': ['Open Sans Bold', 'Arial Unicode MS Bold'],
                    'text-size': 12,
                    'text-offset': [0, 2],
                    'text-anchor': 'top'
                },
                'paint': {
                    'text-color': '#ffffff',
                    'text-halo-color': '#000000<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>South Korea Landforms Explorer</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            position: relative;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .lang-toggle {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .lang-toggle:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .about-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .about-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .map-container {
            height: calc(100vh - 70px);
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
            max-height: 80vh;
            overflow-y: auto;
        }

        .info-panel.active {
            transform: translateX(0);
        }

        .info-panel h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .info-section {
            margin-bottom: 15px;
        }

        .info-section h4 {
            color: #34495e;
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-section p {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            font-size: 12px;
        }

        .legend h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-right: 8px;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .mapboxgl-popup-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .popup-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .popup-subtitle {
            color: #7f8c8d;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .info-panel {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                transform: translateY(100%);
                top: auto;
                bottom: 20px;
            }

            .info-panel.active {
                transform: translateY(0);
            }

            .title {
                font-size: 18px;
            }

            .controls {
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">
            <span>üóª</span>
            <span id="app-title">South Korea Landforms Explorer</span>
        </div>
        <div class="controls">
            <button class="lang-toggle" id="langToggle">ÌïúÍµ≠Ïñ¥</button>
            <a href="#" class="about-btn" id="aboutBtn">About</a>
        </div>
    </div>

    <div class="map-container">
        <div id="map"></div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div id="loading-text">Loading 3D terrain...</div>
        </div>

        <div class="info-panel" id="infoPanel">
            <button class="close-btn" id="closeBtn">√ó</button>
            <h3 id="landform-name">Select a landform</h3>
            <div class="info-section">
                <h4 id="formation-title">Formation</h4>
                <p id="formation-text">Click on a marker to learn about landform formation.</p>
            </div>
            <div class="info-section">
                <h4 id="climate-title">Climate Impact</h4>
                <p id="climate-text">Discover how geography affects local weather patterns.</p>
            </div>
        </div>

        <div class="legend">
            <h4 id="legend-title">Landform Types</h4>
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span id="legend-volcanic">Volcanic</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #27ae60;"></div>
                <span id="legend-mountain">Mountain Range</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3498db;"></div>
                <span id="legend-water">Water Feature</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f39c12;"></div>
                <span id="legend-coastal">Coastal</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #9b59b6;"></div>
                <span id="legend-special">Special Zone</span>
            </div>
        </div>
    </div>

    <script>
        // Language data
        const translations = {
            en: {
                appTitle: "South Korea Landforms Explorer",
                about: "About",
                formationTitle: "Formation",
                climateTitle: "Climate Impact",
                legendTitle: "Landform Types",
                legendVolcanic: "Volcanic",
                legendMountain: "Mountain Range",
                legendWater: "Water Feature",
                legendCoastal: "Coastal",
                legendSpecial: "Special Zone",
                loadingText: "Loading 3D terrain...",
                clickToLearn: "Click on a marker to learn about landform formation.",
                discoverClimate: "Discover how geography affects local weather patterns."
            },
            ko: {
                appTitle: "ÎåÄÌïúÎØºÍµ≠ ÏßÄÌòï ÌÉêÌóòÍ∞Ä",
                about: "Ï†ïÎ≥¥",
                formationTitle: "ÌòïÏÑ± Í≥ºÏ†ï",
                climateTitle: "Í∏∞ÌõÑÏóê ÎØ∏ÏπòÎäî ÏòÅÌñ•",
                legendTitle: "ÏßÄÌòï Ïú†Ìòï",
                legendVolcanic: "ÌôîÏÇ∞ÏßÄÌòï",
                legendMountain: "ÏÇ∞Îß•",
                legendWater: "ÏàòÍ≥Ñ",
                legendCoastal: "Ìï¥ÏïàÏßÄÌòï",
                legendSpecial: "ÌäπÎ≥ÑÏßÄÏó≠",
                loadingText: "3D ÏßÄÌòï Î°úÎî© Ï§ë...",
                clickToLearn: "ÎßàÏª§Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏßÄÌòï ÌòïÏÑ±Ïóê ÎåÄÌï¥ ÏïåÏïÑÎ≥¥ÏÑ∏Ïöî.",
                discoverClimate: "ÏßÄÌòïÏù¥ ÏßÄÏó≠ Í∏∞ÌõÑÏóê ÎØ∏ÏπòÎäî ÏòÅÌñ•ÏùÑ ÏïåÏïÑÎ≥¥ÏÑ∏Ïöî."
            }
        };

        // Enhanced landforms data with geometries for highlighting
        const landformsData = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [126.53, 33.36]
                    },
                    "properties": {
                        "id": "hallasan",
                        "type": "volcanic",
                        "zoomLevel": 10,
                        "highlightGeometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [126.48, 33.31], [126.58, 33.31], 
                                [126.58, 33.41], [126.48, 33.41], [126.48, 33.31]
                            ]]
                        },
                        "name": {
                            "en": "Hallasan Volcano",
                            "ko": "ÌïúÎùºÏÇ∞"
                        },
                        "formation": {
                            "en": "Formed by volcanic activity over millions of years. The shield volcano built up through repeated basaltic lava flows, creating Jeju Island's distinctive dome shape.",
                            "ko": "ÏàòÎ∞±Îßå ÎÖÑÏóê Í±∏Ïπú ÌôîÏÇ∞ ÌôúÎèôÏúºÎ°ú ÌòïÏÑ±ÎêòÏóàÏäµÎãàÎã§. Î∞©Ìå®Ìòï ÌôîÏÇ∞ÏúºÎ°ú Î∞òÎ≥µÎêú ÌòÑÎ¨¥Ïïî Ïö©Ïïî Î∂ÑÏ∂úÎ°ú Ï†úÏ£ºÎèÑÏùò ÎèÖÌäπÌïú Îèî ÌòïÌÉúÎ•º ÎßåÎì§ÏóàÏäµÎãàÎã§."
                        },
                        "climate": {
                            "en": "Creates a vertical climate zone effect. Temperature drops 0.6¬∞C per 100m elevation. Forms orographic precipitation, making the southern slopes wetter than northern areas.",
                            "ko": "ÏàòÏßÅ Í∏∞ÌõÑÎåÄ Ìö®Í≥ºÎ•º ÎßåÎì≠ÎãàÎã§. Í≥†ÎèÑ 100mÎßàÎã§ Í∏∞Ïò®Ïù¥ 0.6¬∞C ÌïòÍ∞ïÌï©ÎãàÎã§. ÏßÄÌòïÏÑ± Í∞ïÏàòÎ•º ÌòïÏÑ±ÌïòÏó¨ ÎÇ®Ï™Ω ÏÇ¨Î©¥Ïù¥ Î∂ÅÏ™ΩÎ≥¥Îã§ Îçî ÏäµÌï©ÎãàÎã§."
                        }
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [128.7, 37.5]
                    },
                    "properties": {
                        "id": "taebaek",
                        "type": "mountain",
                        "zoomLevel": 7,
                        "highlightGeometry": {
                            "type": "LineString",
                            "coordinates": [
                                [128.2, 36.8], [128.4, 37.0], [128.6, 37.2], 
                                [128.8, 37.4], [129.0, 37.6], [129.2, 37.8]
                            ]
                        },
                        "name": {
                            "en": "Taebaek Mountains",
                            "ko": "ÌÉúÎ∞±ÏÇ∞Îß•"
                        },
                        "formation": {
                            "en": "Ancient mountains formed by tectonic uplift and folding of sedimentary rocks during the Mesozoic era. Composed mainly of limestone and granite.",
                            "ko": "Ï§ëÏÉùÎåÄ ÎèôÏïà Ìá¥Ï†ÅÏïîÏùò ÏßÄÍ∞Å ÏúµÍ∏∞ÏôÄ ÏäµÍ≥°ÏúºÎ°ú ÌòïÏÑ±Îêú Í≥†ÎåÄ ÏÇ∞Îß•ÏûÖÎãàÎã§. Ï£ºÎ°ú ÏÑùÌöåÏïîÍ≥º ÌôîÍ∞ïÏïîÏúºÎ°ú Íµ¨ÏÑ±ÎêòÏñ¥ ÏûàÏäµÎãàÎã§."
                        },
                        "climate": {
                            "en": "Acts as a climate barrier, creating the rain shadow effect. Eastern slopes receive more precipitation from Pacific moisture, while western areas are drier.",
                            "ko": "Í∏∞ÌõÑ Ïû•Î≤Ω Ïó≠Ìï†ÏùÑ ÌïòÏó¨ ÎπÑÍ∑∏Îäò Ìö®Í≥ºÎ•º ÎßåÎì≠ÎãàÎã§. ÎèôÏ™Ω ÏÇ¨Î©¥ÏùÄ ÌÉúÌèâÏñë ÏàòÎ∂ÑÏúºÎ°ú Îçî ÎßéÏùÄ Í∞ïÏàòÎ•º Î∞õÍ≥†, ÏÑúÏ™ΩÏùÄ Îçî Í±¥Ï°∞Ìï©ÎãàÎã§."
                        }
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [128.5, 35.8]
                    },
                    "properties": {
                        "id": "nakdong",
                        "type": "water",
                        "zoomLevel": 8,
                        "highlightGeometry": {
                            "type": "LineString",
                            "coordinates": [
                                [128.8, 37.1], [128.7, 36.8], [128.6, 36.5], [128.5, 36.2],
                                [128.4, 35.9], [128.3, 35.6], [128.2, 35.3], [128.1, 35.0], [128.0, 34.8]
                            ]
                        },
                        "name": {
                            "en": "Nakdong River",
                            "ko": "ÎÇôÎèôÍ∞ï"
                        },
                        "formation": {
                            "en": "Korea's longest river, carved through tectonic valleys and alluvial plains. Flows from Taebaek Mountains to the Korea Strait, shaped by millions of years of erosion.",
                            "ko": "ÌïúÍµ≠ÏóêÏÑú Í∞ÄÏû• Í∏¥ Í∞ïÏúºÎ°ú, ÏßÄÍ∞Å Í≥ÑÍ≥°Í≥º Ï∂©Ï†ÅÌèâÏïºÎ•º Í¥ÄÌÜµÌïòÏó¨ ÌùêÎ¶ÖÎãàÎã§. ÌÉúÎ∞±ÏÇ∞Îß•ÏóêÏÑú ÌïúÍµ≠Ìï¥ÌòëÍπåÏßÄ ÌùêÎ•¥Î©∞, ÏàòÎ∞±Îßå ÎÖÑÏùò Ïπ®ÏãùÏúºÎ°ú ÌòïÏÑ±ÎêòÏóàÏäµÎãàÎã§."
                        },
                        "climate": {
                            "en": "Creates a microclimate with higher humidity along the river valley. Moderates temperature extremes and supports agriculture through irrigation.",
                            "ko": "Í∞ï Ïú†Ïó≠ÏùÑ Îî∞Îùº ÎÜíÏùÄ ÏäµÎèÑÎ•º Í∞ÄÏßÑ ÎØ∏Í∏∞ÌõÑÎ•º ÎßåÎì≠ÎãàÎã§. Í∑πÌïú Í∏∞Ïò®ÏùÑ ÏôÑÌôîÌïòÍ≥† Í¥ÄÍ∞úÎ•º ÌÜµÌï¥ ÎÜçÏóÖÏùÑ ÏßÄÏõêÌï©ÎãàÎã§."
                        }
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [129.3, 35.2]
                    },
                    "properties": {
                        "id": "ria",
                        "type": "coastal",
                        "zoomLevel": 9,
                        "highlightGeometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [128.8, 34.8], [129.8, 34.8], [129.8, 35.6], 
                                [128.8, 35.6], [128.8, 34.8]
                            ]]
                        },
                        "name": {
                            "en": "Ria Coastline",
                            "ko": "Î¶¨ÏïÑÏä§Ïãù Ìï¥Ïïà"
                        },
                        "formation": {
                            "en": "Formed when post-glacial sea level rise flooded coastal river valleys, creating deep, narrow inlets and numerous islands along the southern coast.",
                            "ko": "ÎπôÌïòÍ∏∞ Ïù¥ÌõÑ Ìï¥ÏàòÎ©¥ ÏÉÅÏäπÏúºÎ°ú Ïó∞Ïïà ÌïòÏ≤ú Í≥ÑÍ≥°Ïù¥ Ïπ®ÏàòÎêòÏñ¥ ÌòïÏÑ±ÎêòÏóàÏúºÎ©∞, ÎÇ®Ìï¥ÏïàÏùÑ Îî∞Îùº ÍπäÍ≥† Ï¢ÅÏùÄ ÎßåÍ≥º ÏàòÎßéÏùÄ ÏÑ¨Îì§ÏùÑ ÎßåÎì§ÏóàÏäµÎãàÎã§."
                        },
                        "climate": {
                            "en": "The complex coastline creates sheltered bays with milder microclimates. Protected areas have less wind and more stable temperatures than exposed coasts.",
                            "ko": "Î≥µÏû°Ìïú Ìï¥ÏïàÏÑ†Ïù¥ Ïò®ÌôîÌïú ÎØ∏Í∏∞ÌõÑÎ•º Í∞ÄÏßÑ Î≥¥Ìò∏Îêú ÎßåÏùÑ ÎßåÎì≠ÎãàÎã§. Î≥¥Ìò∏Îêú ÏßÄÏó≠ÏùÄ ÎÖ∏Ï∂úÎêú Ìï¥ÏïàÎ≥¥Îã§ Î∞îÎûåÏù¥ Ï†ÅÍ≥† Îçî ÏïàÏ†ïÎêú Í∏∞Ïò®ÏùÑ Í∞ÄÏßëÎãàÎã§."
                        }
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [127.0, 38.0]
                    },
                    "properties": {
                        "id": "dmz",
                        "type": "special",
                        "zoomLevel": 8,
                        "highlightGeometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [125.0, 37.8], [129.5, 37.8], [129.5, 38.2], 
                                [125.0, 38.2], [125.0, 37.8]
                            ]]
                        },
                        "name": {
                            "en": "Demilitarized Zone (DMZ)",
                            "ko": "ÎπÑÎ¨¥Ïû•ÏßÄÎåÄ"
                        },
                        "formation": {
                            "en": "A political boundary established in 1953, following natural topographic features like rivers and ridgelines across the Korean peninsula.",
                            "ko": "1953ÎÖÑÏóê ÏÑ§Ï†ïÎêú Ï†ïÏπòÏ†Å Í≤ΩÍ≥ÑÎ°ú, ÌïúÎ∞òÎèÑÎ•º Í∞ÄÎ°úÏßÄÎ•¥Îäî Í∞ïÍ≥º Îä•ÏÑ† Í∞ôÏùÄ ÏûêÏó∞ ÏßÄÌòïÏùÑ Îî∞Îùº ÌòïÏÑ±ÎêòÏóàÏäµÎãàÎã§."
                        },
                        "climate": {
                            "en": "Minimal human activity has created a unique ecosystem. The area experiences natural climate patterns without urban heat island effects.",
                            "ko": "Ïù∏Í∞Ñ ÌôúÎèôÏù¥ ÏµúÏÜåÌôîÎêòÏñ¥ ÎèÖÌäπÌïú ÏÉùÌÉúÍ≥ÑÎ•º ÎßåÎì§ÏóàÏäµÎãàÎã§. ÎèÑÏãú Ïó¥ÏÑ¨ Ìö®Í≥º ÏóÜÏù¥ ÏûêÏó∞Ïä§Îü¨Ïö¥ Í∏∞ÌõÑ Ìå®ÌÑ¥ÏùÑ Í≤ΩÌóòÌï©ÎãàÎã§."
                        }
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [126.8, 33.5]
                    },
                    "properties": {
                        "id": "oreum",
                        "type": "volcanic",
                        "zoomLevel": 11,
                        "highlightGeometry": {
                            "type": "MultiPoint",
                            "coordinates": [
                                [126.7, 33.4], [126.8, 33.5], [126.9, 33.6], 
                                [126.6, 33.3], [127.0, 33.7]
                            ]
                        },
                        "name": {
                            "en": "Oreum Volcanic Cones",
                            "ko": "Ï†úÏ£º Ïò§Î¶Ñ"
                        },
                        "formation": {
                            "en": "Small parasitic volcanic cones formed by localized eruptions on Jeju Island. Created when magma found weak points in the main volcanic structure.",
                            "ko": "Ï†úÏ£ºÎèÑÏùò Íµ≠ÏÜåÏ†Å Î∂ÑÏ∂úÎ°ú ÌòïÏÑ±Îêú ÏûëÏùÄ Í∏∞ÏÉù ÌôîÏÇ∞Ï∂îÏûÖÎãàÎã§. ÎßàÍ∑∏ÎßàÍ∞Ä Ï£º ÌôîÏÇ∞ Íµ¨Ï°∞Ïùò ÏïΩÌïú ÏßÄÏ†êÏùÑ Î∞úÍ≤¨ÌñàÏùÑ Îïå ÎßåÎì§Ïñ¥Ï°åÏäµÎãàÎã§."
                        },
                        "climate": {
                            "en": "Each oreum creates its own microclimate. Wind patterns change around the cones, creating different moisture and temperature conditions on various slopes.",
                            "ko": "Í∞Å Ïò§Î¶ÑÏùÄ Í≥†Ïú†Ìïú ÎØ∏Í∏∞ÌõÑÎ•º ÎßåÎì≠ÎãàÎã§. ÌôîÏÇ∞Ï∂î Ï£ºÎ≥ÄÏùò Î∞îÎûå Ìå®ÌÑ¥Ïù¥ Î≥ÄÌôîÌïòÏó¨ Îã§ÏñëÌïú ÏÇ¨Î©¥ÏóêÏÑú ÏÑúÎ°ú Îã§Î•∏ ÏäµÎèÑÏôÄ Ïò®ÎèÑ Ï°∞Í±¥ÏùÑ ÎßåÎì≠ÎãàÎã§."
                        }
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [128.0, 36.5]
                    },
                    "properties": {
                        "id": "sobaek",
                        "type": "mountain",
                        "zoomLevel": 7,
                        "highlightGeometry": {
                            "type": "LineString",
                            "coordinates": [
                                [127.5, 36.0], [127.7, 36.2], [127.9, 36.4], 
                                [128.1, 36.6], [128.3, 36.8], [128.5, 37.0]
                            ]
                        },
                        "name": {
                            "en": "Sobaek Mountains",
                            "ko": "ÏÜåÎ∞±ÏÇ∞Îß•"
                        },
                        "formation": {
                            "en": "Formed through parallel folding and faulting processes. This younger mountain range was uplifted more recently than the Taebaek Mountains.",
                            "ko": "ÌèâÌñâÌïú ÏäµÍ≥°Í≥º Îã®Ï∏µ Í≥ºÏ†ïÏùÑ ÌÜµÌï¥ ÌòïÏÑ±ÎêòÏóàÏäµÎãàÎã§. Ïù¥ Ï†äÏùÄ ÏÇ∞Îß•ÏùÄ ÌÉúÎ∞±ÏÇ∞Îß•Î≥¥Îã§ Îçî ÏµúÍ∑ºÏóê ÏúµÍ∏∞ÎêòÏóàÏäµÎãàÎã§."
                        },
                        "climate": {
                            "en": "Creates a transitional climate zone between continental and oceanic influences. Moderates the harsh continental climate from the north.",
                            "ko": "ÎåÄÎ•ôÏÑ±Í≥º Ìï¥ÏñëÏÑ± ÏòÅÌñ• ÏÇ¨Ïù¥Ïùò Ï†ÑÏù¥ Í∏∞ÌõÑÎåÄÎ•º ÎßåÎì≠ÎãàÎã§. Î∂ÅÏ™ΩÏóêÏÑú Ïò§Îäî ÌòπÎèÖÌïú ÎåÄÎ•ôÏÑ± Í∏∞ÌõÑÎ•º ÏôÑÌôîÌï©ÎãàÎã§."
                        }
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [128.4, 38.1]
                    },
                    "properties": {
                        "id": "seorak",
                        "type": "mountain",
                        "zoomLevel": 10,
                        "highlightGeometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [128.2, 37.9], [128.6, 37.9], [128.6, 38.3], 
                                [128.2, 38.3], [128.2, 37.9]
                            ]]
                        },
                        "name": {
                            "en": "Seoraksan",
                            "ko": "ÏÑ§ÏïÖÏÇ∞"
                        },
                        "formation": {
                            "en": "Granite peaks formed by intrusive igneous activity and subsequent erosion. The dramatic rocky spires were carved by glacial and water erosion over millions of years.",
                            "ko": "Í¥ÄÏûÖ ÌôîÏÑ± ÌôúÎèôÍ≥º Í∑∏Ïóê Îî∞Î•∏ Ïπ®ÏãùÏúºÎ°ú ÌòïÏÑ±Îêú ÌôîÍ∞ïÏïî Î¥âÏö∞Î¶¨Îì§ÏûÖÎãàÎã§. Í∑πÏ†ÅÏù∏ ÏïîÏÑù Ï≤®ÌÉëÎì§ÏùÄ ÏàòÎ∞±Îßå ÎÖÑÏóê Í±∏Ïπú ÎπôÌïòÏôÄ Î¨ºÏùò Ïπ®ÏãùÏúºÎ°ú Ï°∞Í∞ÅÎêòÏóàÏäµÎãàÎã§."
                        },
                        "climate": {
                            "en": "High elevation creates alpine climate conditions. Receives heavy snowfall in winter and has the first autumn colors in Korea due to elevation effects.",
                            "ko": "ÎÜíÏùÄ Í≥†ÎèÑÎ°ú Ïù∏Ìï¥ Í≥†ÏÇ∞ Í∏∞ÌõÑ Ï°∞Í±¥ÏùÑ ÎßåÎì≠ÎãàÎã§. Í≤®Ïö∏Ïóê ÎßéÏùÄ ÎààÏùÑ Î∞õÍ≥†, Í≥†ÎèÑ Ìö®Í≥ºÎ°ú Ïù∏Ìï¥ ÌïúÍµ≠ÏóêÏÑú Í∞ÄÏû• Î®ºÏ†Ä Í∞ÄÏùÑ Îã®ÌíçÏù¥ ÎÇòÌÉÄÎÇ©ÎãàÎã§."
                        }
                    }
                }
            ]
        };

        // Global variables
        let map;
        let currentLanguage = 'en';
        let activePopup = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Valid Mapbox access token
            mapboxgl.accessToken = 'pk.eyJ1Ijoic3Vnb2lpNzciLCJhIjoiY21kcW0wcXRnMDhiNjJzc2F3bHQ4N3U5OSJ9.5oxDaBSXA453w8ixSwDtbg';
            
            initializeMap();
            setupEventListeners();
            updateLanguage();
        });

        function initializeMap() {
            map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/satellite-streets-v12',
                center: [127.5, 36.0], // Center of South Korea
                zoom: 6.5,
                pitch: 45,
                bearing: 0,
                antialias: true
            });

            map.on('style.load', () => {
                // Add 3D terrain
                map.addSource('mapbox-dem', {
                    'type': 'raster-dem',
                    'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
                    'tileSize': 512,
                    'maxzoom': 14
                });

                map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });

                // Add landforms markers
                addLandformsToMap();
                
                // Hide loading screen
                document.getElementById('loading').style.display = 'none';
            });

            // Add navigation controls
            map.addControl(new mapboxgl.NavigationControl(), 'top-left');
            map.addControl(new mapboxgl.FullscreenControl(), 'top-left');
        }

        function addLandformsToMap() {
            // Add source
            map.addSource('landforms', {
                'type': 'geojson',
                'data': landformsData
            });

            // Add markers layer
            map.addLayer({
                'id': 'landforms-layer',
                'type': 'circle',
                'source': 'landforms',
                'paint': {
                    'circle-radius': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        5, 8,
                        10, 15
                    ],
                    'circle-color': [
                        'match',
                        ['get', 'type'],
                        'volcanic', '#e74c3c',
                        'mountain', '#27ae60',
                        'water', '#3498db',
                        'coastal', '#f39c12',
                        'special', '#9b59b6',
                        '#34495e'
                    ],
                    'circle-stroke-width': 2,
                    'circle-stroke-color': '#ffffff',
                    'circle-opacity': 0.8
                }
            });

                    'text-halo-color': '#000000',
                    'text-halo-width': 1
                }
            });

            // Add click handlers
            map.on('click', 'landforms-layer', (e) => {
                const feature = e.features[0];
                const properties = feature.properties;
                
                // Show landform info
                showLandformInfo(properties);
                
                // Highlight the landform
                highlightLandform(properties);
                
                // Calculate bounds for the highlight geometry
                const highlightGeom = properties.highlightGeometry;
                const zoomLevel = properties.zoomLevel || 8;
                
                if (highlightGeom) {
                    let bounds = new mapboxgl.LngLatBounds();
                    
                    if (highlightGeom.type === 'Polygon') {
                        highlightGeom.coordinates[0].forEach(coord => bounds.extend(coord));
                    } else if (highlightGeom.type === 'LineString') {
                        highlightGeom.coordinates.forEach(coord => bounds.extend(coord));
                    } else if (highlightGeom.type === 'MultiPoint') {
                        highlightGeom.coordinates.forEach(coord => bounds.extend(coord));
                    } else {
                        // For point or if no highlight geometry, use the marker position
                        bounds.extend(feature.geometry.coordinates);
                    }
                    
                    // Fly to bounds with padding
                    map.fitBounds(bounds, {
                        padding: 100,
                        maxZoom: zoomLevel,
                        duration: 2000
                    });
                } else {
                    // Fallback to simple fly to
                    map.flyTo({
                        center: feature.geometry.coordinates,
                        zoom: zoomLevel,
                        pitch: 60,
                        duration: 2000
                    });
                }
            });

            // Change cursor on hover
            map.on('mouseenter', 'landforms-layer', () => {
                map.getCanvas().style.cursor = 'pointer';
            });

            map.on('mouseleave', 'landforms-layer', () => {
                map.getCanvas().style.cursor = '';
            });

            // Add popup on hover
            map.on('mouseenter', 'landforms-layer', (e) => {
                const feature = e.features[0];
                const coordinates = feature.geometry.coordinates.slice();
                const nameData = feature.properties.name;
                const name = typeof nameData === 'string' ? JSON.parse(nameData) : nameData;

                if (activePopup) {
                    activePopup.remove();
                }

                activePopup = new mapboxgl.Popup({
                    closeButton: false,
                    closeOnClick: false
                })
                .setLngLat(coordinates)
                .setHTML(`
                    <div class="popup-title">${name[currentLanguage] || name.en || 'Unknown'}</div>
                    <div class="popup-subtitle">${currentLanguage === 'en' ? 'Click to learn more' : 'ÏûêÏÑ∏Ìûà ÏïåÏïÑÎ≥¥Î†§Î©¥ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî'}</div>
                `)
                .addTo(map);
            });

            map.on('mouseleave', 'landforms-layer', () => {
                if (activePopup) {
                    activePopup.remove();
                    activePopup = null;
                }
            });
        }

        function highlightLandform(properties) {
            const highlightGeom = properties.highlightGeometry;
            
            if (highlightGeom) {
                const highlightFeature = {
                    'type': 'Feature',
                    'geometry': highlightGeom,
                    'properties': {}
                };
                
                // Update highlight source
                map.getSource('highlight').setData({
                    'type': 'FeatureCollection',
                    'features': [highlightFeature]
                });
                
                // Auto-remove highlight after 5 seconds
                setTimeout(() => {
                    if (map.getSource('highlight')) {
                        map.getSource('highlight').setData({
                            'type': 'FeatureCollection',
                            'features': []
                        });
                    }
                }, 5000);
            }
        }

        function showLandformInfo(properties) {
            const panel = document.getElementById('infoPanel');
            
            // Parse JSON strings if needed
            const name = typeof properties.name === 'string' ? JSON.parse(properties.name) : properties.name;
            const formation = typeof properties.formation === 'string' ? JSON.parse(properties.formation) : properties.formation;
            const climate = typeof properties.climate === 'string' ? JSON.parse(properties.climate) : properties.climate;

            document.getElementById('landform-name').textContent = name[currentLanguage] || name.en || 'Unknown';
            document.getElementById('formation-text').textContent = formation[currentLanguage] || formation.en || 'No information available';
            document.getElementById('climate-text').textContent = climate[currentLanguage] || climate.en || 'No information available';

            panel.classList.add('active');
        }

        function setupEventListeners() {
            // Language toggle
            document.getElementById('langToggle').addEventListener('click', function() {
                currentLanguage = currentLanguage === 'en' ? 'ko' : 'en';
                updateLanguage();
                updateMapLabels();
            });

            // Close info panel
            document.getElementById('closeBtn').addEventListener('click', function() {
                document.getElementById('infoPanel').classList.remove('active');
                
                // Clear highlight when closing panel
                if (map && map.getSource('highlight')) {
                    map.getSource('highlight').setData({
                        'type': 'FeatureCollection',
                        'features': []
                    });
                }
            });

            // About button (placeholder)
            document.getElementById('aboutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                alert(currentLanguage === 'en' ? 
                    'This app helps students learn about South Korea\'s landforms and their climate effects!' :
                    'Ïù¥ Ïï±ÏùÄ ÌïôÏÉùÎì§Ïù¥ ÎåÄÌïúÎØºÍµ≠Ïùò ÏßÄÌòïÍ≥º Í∏∞ÌõÑÏóê ÎØ∏ÏπòÎäî ÏòÅÌñ•ÏùÑ Î∞∞Ïö∞Îäî Îç∞ ÎèÑÏõÄÏùÑ Ï§çÎãàÎã§!');
            });
        }

        function updateLanguage() {
            const t = translations[currentLanguage];
            
            document.getElementById('app-title').textContent = t.appTitle;
            document.getElementById('aboutBtn').textContent = t.about;
            document.getElementById('langToggle').textContent = currentLanguage === 'en' ? 'ÌïúÍµ≠Ïñ¥' : 'English';
            document.getElementById('formation-title').textContent = t.formationTitle;
            document.getElementById('climate-title').textContent = t.climateTitle;
            document.getElementById('legend-title').textContent = t.legendTitle;
            document.getElementById('legend-volcanic').textContent = t.legendVolcanic;
            document.getElementById('legend-mountain').textContent = t.legendMountain;
            document.getElementById('legend-water').textContent = t.legendWater;
            document.getElementById('legend-coastal').textContent = t.legendCoastal;
            document.getElementById('legend-special').textContent = t.legendSpecial;
            document.getElementById('loading-text').textContent = t.loadingText;
            
            // Update info panel default text
            const infoPanel = document.getElementById('infoPanel');
            if (!infoPanel.classList.contains('active')) {
                document.getElementById('formation-text').textContent = t.clickToLearn;
                document.getElementById('climate-text').textContent = t.discoverClimate;
            }
        }

        function updateMapLabels() {
            if (map.getLayer('landforms-labels')) {
                map.setLayoutProperty('landforms-labels', 'text-field', 
                    ['get', ['literal', currentLanguage], ['get', 'name']]
                );
            }
        }

        // Add some educational animations
        function animateToRandomLandform() {
            const features = landformsData.features;
            const randomFeature = features[Math.floor(Math.random() * features.length)];
            
            map.flyTo({
                center: randomFeature.geometry.coordinates,
                zoom: 9,
                pitch: 60,
                bearing: Math.random() * 360,
                duration: 3000
            });
            
            setTimeout(() => {
                showLandformInfo(randomFeature.properties);
            }, 2000);
        }

        // Optional: Add a tour mode (can be activated by a button)
        function startTour() {
            let currentIndex = 0;
            const features = landformsData.features;
            
            function visitNext() {
                if (currentIndex >= features.length) {
                    currentIndex = 0;
                }
                
                const feature = features[currentIndex];
                map.flyTo({
                    center: feature.geometry.coordinates,
                    zoom: 8,
                    pitch: 50,
                    duration: 2000
                });
                
                setTimeout(() => {
                    showLandformInfo(feature.properties);
                    currentIndex++;
                    setTimeout(visitNext, 5000);
                }, 2000);
            }
            
            visitNext();
        }

        // App is ready to use with valid Mapbox token!
    </script>
</body>
</html>
